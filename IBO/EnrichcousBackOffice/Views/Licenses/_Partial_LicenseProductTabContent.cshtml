@model IEnumerable<EnrichcousBackOffice.Models.CustomizeModel.LicensesItemGroup>
@using Enrichcous.Payment.Mxmerchant.Config.Enums;
@using EnrichcousBackOffice.Models
@using EnrichcousBackOffice.Models.CustomizeModel
@using EnrichcousBackOffice.AppLB
@using System.Web.Script.Serialization;
@{
    ViewBag.Title = "Licenses Product & Addon";
    List<LicenseProductView> Products = ViewBag.Products;
    Dictionary<string, bool> p = ViewBag.p;
    var partners = ViewBag.Partners as List<C_Partner>;
}
<style>
    .error {
        color: red;
    }

    input.error {
        border: 1px solid red !important;
    }

    .iradio_flat-blue.disabled + span {
        text-decoration: line-through;
    }
</style>

<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
<!-- Main content -->
<section class="content-license">
    <div id="partial_loading" style="text-align: center;display:none;position: fixed;width: 100%;height: 100%;top: 0;left: 0;background-color: gray;opacity: 0.5;z-index: 1000;padding-top: 25%;">
        <img src="/Content/ajax-loaders/loading-partial.gif">
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="box-tools text-right" style="margin:11px"><a onclick="new_product()" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> New Subscription</a></div>
            <div id="product_tab" class="box-body">
                <div class="panel-group">
                    <div class="panel panel-primary">
                        <div class="panel-heading" id="active-panel" onclick="togglePanel(this)" style="cursor:pointer">
                            <span style="font-size:18px;"><button type="button" style="padding: 0px 6px;transform: translateY(-2px);" class="btn btn-sm btn btn-success"><i class="fa fa-play" aria-hidden="true"></i></button> Active</span>
                            <a href="#" class="icon" style="color:white;float:right;"><i class="fa fa-minus" aria-hidden="true"></i></a>
                        </div>
                        <div class="panel-body">
                            <table id="tb_products" style="width: 100%;border-collapse: collapse;margin-top:0px;" class="table-bordered striped3">
                                <thead style="background-color: #aad3ea">
                                    <tr>
                                        <th width="35%">NAME</th>
                                        <th width="5%" style="text-align:center;">STATUS</th>
                                        <th width="15%" style="text-align:center;">AVAILABLE FOR SIMPLY</th>
                                        <th width="10%" style="text-align:center;">PRICE</th>
                                        <th width="10%" style="text-align:center;">Type</th>
                                        <th width="5%" style="text-align:center;">Level</th>
                                        <th width="10%" style="text-align:center;"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        var SubscriptionIsActive = Products.Where(x => x.Product.Active == true);
                                    }
                                    @if (SubscriptionIsActive.Count() > 0)
                                    {
                                        foreach (var pr in SubscriptionIsActive)
                                        {
                                            <tr id="pr_@pr.Product.Id" class="@(pr.Product.Type !="other" ?"prd_collapse":"") hover">
                                                <td>
                                                    @if (pr.Product.Type != "other" && pr.Product.Type != "giftcard")
                                                    {
                                                        <a style="color: dodgerblue; margin: 0px 10px; padding: 0px;vertical-align:top;" class="icon_span btn fa fa-2x fa-plus-square-o"></a>
                                                        <a style="color: orange; margin: 0px 10px; padding: 0px; display: none;vertical-align:top;" class="icon_span btn fa fa-2x fa-minus-square-o"></a>
                                                    }

                                                    <div style="display:inline-block">
                                                        <b style="color:green" id="product_name_@pr.Product.Id" class="prod_name">@pr.Product.Name</b>
                                                        @if (pr.Product.isAddon != true)
                                                        {

                                                            if (string.IsNullOrEmpty(pr.Product.Code_POSSystem))
                                                            {
                                                                <label class="label label-success">version 2</label>
                                                            }
                                                            else
                                                            {
                                                                <label class="label label-warning">version 1</label>
                                                            }
                                                        }
                                                        <br />
                                                        @if (pr.Product.Trial_Months > 0)
                                                        {
                                                            <label class="label label-default">Allow Trial (@pr.Product.Trial_Months @(pr.Product.Trial_Months == 1?"month":"months"))</label>
                                                        }
                                                        @if (pr.Product.AllowSlice == true)
                                                        {
                                                            <label class="label label-default">Allow Slice</label>
                                                        }
                                                        @if (pr.Product.Promotion_Apply_Months > 0)
                                                        {
                                                            <label class="label label-default">Allow Promotion (@pr.Product.Promotion_Apply_Months @(pr.Product.Promotion_Apply_Months == 1?"month":"months"))</label>
                                                        }
                                                    </div>

                                                </td>
                                                <td style="text-align:center;">

                                                    <label class="switch on_row" style="vertical-align: text-top;">
                                                        <input id="status_@pr.Product.Id" type="checkbox" onchange="active_item(this,'@pr.Product.Id','@(@pr.Product.Active == true?"enable":"disable")')" @if (@pr.Product.Active == true) { @Html.Raw("checked") }>
                                                        <span class="slider round"></span>
                                                    </label>
                                                </td>
                                                <td style="text-align:center;">
                                                    <label class="switch on_row" style="vertical-align: text-top;">
                                                        <input id="available_@pr.Product.Id" type="checkbox" onchange="available_item(this,'@pr.Product.Id','@(@pr.Product.Available == true?"enable":"disable")')" @if (@pr.Product.Available == true) { @Html.Raw("checked") }>
                                                        <span class="slider round"></span>
                                                    </label>
                                                </td>
                                                <td style="text-align:center;">
                                                    @(pr.Product.Price != null ? string.Format("${0:#,0.00}", pr.Product.Price):"N/A") /
                                                    <span>@(pr.Product.NumberOfPeriod == 1 ? "" : pr.Product.NumberOfPeriod?.ToString()) @(pr.Product.SubscriptionDuration != "MONTHLY" ? "times" : (string.IsNullOrEmpty(pr.Product.PeriodRecurring) ? "month" : pr.Product.PeriodRecurring.ToLower().Replace("ly", "")) + (pr.Product.NumberOfPeriod == 1 ? "" : "s"))</span>
                                                    @if (pr.Product.FlagDeactivateExpires == 1)
                                                    {
                                                        <i class="fa fa-flag text-danger" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Allow deactive when expires"></i>
                                                    }
                                                </td>
                                                <td style="text-align:center;">
                                                    @if (pr.Product.Type == "license")
                                                    {
                                                        <label class="label label-success">License</label>
                                                    }
                                                    else if (pr.Product.Type == "addon")
                                                    {
                                                        <label class="label label-warning">Addon</label>
                                                    }
                                                    else if (pr.Product.Type == "giftcard")
                                                    {
                                                        <label class="label bg-orange">Gift Card</label>
                                                    }
                                                    else
                                                    {
                                                        <label class="label label-primary">Other</label>
                                                    }
                                                </td>
                                                <td style="text-align:center;">
                                                    @if (pr.Product.Level == 0 || pr.Product.Level == null)
                                                    {
                                                        <text>
                                                            <label class="label label-default">N/A</label>
                                                        </text>
                                                    }
                                                    else
                                                    {
                                                        <label class="label label-success"> @pr.Product.Level</label>
                                                    }
                                                </td>
                                                <td style="text-align:center;">
                                                    <a onclick="edit_product('@pr.Product.Id', $(this))" class="btn btn-default fa fa-pencil text-green on_row" style="font-size:1.2em">
                                                        <img class="loading_img" src="~/Content/ajax-loaders/ajax-loader-1.gif" style="display:none" />
                                                    </a>
                                                    <a onclick="check_delete_product('@pr.Product.Id', $(this))" class="btn btn-default fa fa-trash-o text-red on_row" style="font-size:1.2em">
                                                        <img class="loading_img" src="~/Content/ajax-loaders/ajax-loader-1.gif" style="display:none" />
                                                    </a>
                                                </td>
                                            </tr>
                                            if (pr.Product.Type != "other" && pr.Product.Type != "giftcard")
                                            {
                                                <tr class="models_list" style="border-bottom: 1px double; display:none; background-color:#DDD">
                                                    <td colspan="7" style="padding-left:50px;border:none;">
                                                        <div style="border: 1px solid orange">
                                                            <table class="table table-bordered table-striped table-hover" style="margin:0px; background-color:#fff">

                                                                <tbody>
                                                                    @foreach (var group in Model.Where(g =>
                                                                    ((g.Group.Options.Contains("Product") && pr.Product.isAddon != true)
                                                                    || (g.Group.Options.Contains("Addon") && pr.Product.isAddon == true))
                                                                        && (g.Group.ID != 1000000 || (g.Group.ID == 1000000 && string.IsNullOrEmpty(pr.Product.Code_POSSystem)))))
                                                                    {
                                                                        <tr class="group_@group.Group.ID" style="background-color: #a3cbe2">
                                                                            <th colspan="3" onclick="edit_group('@group.Group.ID')">
                                                                                <div class="pull-left">
                                                                                    <h3 id="group_name_@group.Group.ID" class="pull-left" style="margin:0">@group.Group.Name</h3>
                                                                                </div>

                                                                            </th>
                                                                            <th></th>
                                                                        </tr>

                                                                        foreach (var item in group.Items)
                                                                        {
                                                                            var LP_item = pr.Items.Where(l => l.License_Item_Code == item.Code).FirstOrDefault();
                                                                            if (LP_item?.Enable == true)
                                                                            {
                                                                                <tr class="group_@group.Group.ID item" id="item_@item.ID">
                                                                                    <td></td>
                                                                                    <td></td>
                                                                                    <td>
                                                                                        <span id="item_name_@item.ID">@item.Name</span>
                                                                                    </td>

                                                                                    <td class="product_@pr.Product.Id" style="text-align:left; font-weight:bold">
                                                                                        @*<div class="pull-right btn_group" style="visibility: hidden; opacity: 1; margin-left:-50px">
                                                                                                <a onclick="show_modal('@pr.Product.Id','@item.ID')" class="btn btn-default fa fa-pencil text-green" style="font-size:1.2em; padding:2px 10px"></a>
                                                                                            </div>*@
                                                                                        <ul class="todo-list ui-sortable">
                                                                                            <li>
                                                                                                @*@item.Type :*@ @(item.Type == "FEATURE" ? (LP_item?.Value == 1 ? "Yes" : "No") : LP_item?.Value.ToString())
                                                                                            </li>
                                                                                        </ul>
                                                                                    </td>
                                                                                </tr>
                                                                            }
                                                                        }

                                                                        foreach (var childgroup in group.ChildGroups)
                                                                        {
                                                                            <tr class="group_@group.Group.ID group_@childgroup.Group.ID">
                                                                                <td></td>
                                                                                <td colspan="2" onclick="edit_group('@childgroup.Group.ID')">
                                                                                    <b id="group_name_@childgroup.Group.ID" class="pull-left">@childgroup.Group.Name</b>
                                                                                </td>
                                                                                <td></td>
                                                                            </tr>

                                                                            foreach (var item in childgroup.Items)
                                                                            {
                                                                                var LP_item = pr.Items.Where(l => l.License_Item_Code == item.Code).FirstOrDefault();
                                                                                if (LP_item?.Enable == true)
                                                                                {
                                                                                    <tr class="group_@group.Group.ID item" id="item_@item.ID">
                                                                                        <td></td>
                                                                                        <td></td>
                                                                                        <td>
                                                                                            <span id="item_name_@item.ID">@item.Name</span>
                                                                                        </td>

                                                                                        <td class="product_@pr.Product.Id" style="text-align:left; font-weight:bold">
                                                                                            @*<div class="pull-right btn_group" style="visibility: hidden; opacity: 1; margin-left:-50px">
                                                                                                    <a onclick="show_modal('@pr.Product.Id','@item.ID')" class="btn btn-default fa fa-pencil text-green" style="font-size:1.2em; padding:2px 10px"></a>
                                                                                                </div>*@
                                                                                            <ul class="todo-list ui-sortable">
                                                                                                <li>
                                                                                                    @*@item.Type :*@ @(item.Type == "FEATURE" ? (LP_item?.Value == 1 ? "Yes" : "No") : LP_item?.Value.ToString())
                                                                                                </li>
                                                                                            </ul>
                                                                                        </td>
                                                                                    </tr>
                                                                                }
                                                                            }
                                                                        }
                                                                    }

                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="col-md-8 col-md-offset-2" id="div-btn-action-product-@pr.Product.Id" style="text-align:center; padding:10px">
                                                                <a class="btn btn-warning" onclick="show_select_item('@pr.Product.Id',this,true)">
                                                                    Update License
                                                                    <img class="loading_img" src="~/Content/ajax-loaders/ajax-loader-1.gif" style="display:none" />
                                                                </a>
                                                                <a class="btn btn-success" onclick="show_select_item('@pr.Product.Id',this)">
                                                                    Add license
                                                                    <img class="loading_img" src="~/Content/ajax-loaders/ajax-loader-1.gif" style="display:none" />
                                                                </a>
                                                                @if (pr.UpdateStore)
                                                                {
                                                                    <a id="btn-update-store-fail" data-toggle="tooltip" title="@(pr.NumberUpdated) stores has been updated" class="btn btn-info hide" onclick="show_stores_actived('@pr.Product.Id', true, this)">
                                                                        Continue Update
                                                                        <img class="loading_img" src="~/content/ajax-loaders/ajax-loader-1.gif" style="display:none" />
                                                                    </a>
                                                                }

                                                            </div>
                                                            <div class="col-md-2" style="padding:10px">
                                                                <button type="button" onclick="close_collapse()" class="btn btn-sm btn-default pull-right"><i class="fa fa-close"></i> Close</button>
                                                            </div>
                                                        </div>

                                                    </td>
                                                </tr>
                                            }


                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="7" class="text-center">
                                                No License Found !
                                            </td>
                                        </tr>
                                    }

                                </tbody>
                            </table>
                            <button type="button" style="margin-top:10px;float:right;" onclick="$('#active-panel').trigger('click');" class="btn btn-sm btn-default">Close</button>
                        </div>
                    </div>

                </div>


                <div class="panel-group">
                    <div class="panel panel-primary">
                        <div class="panel-heading" id="deactive-panel" onclick="togglePanel(this)" style="cursor:pointer">
                            <span style="font-size:18px;"><button type="button" style="padding: 0px 6px;transform: translateY(-2px);" class="btn btn-sm btn btn-danger"><i class="fa fa-stop" aria-hidden="true"></i></button> DeActive</span>
                            <a href="#" class="icon" style="color:white;float:right;"><i class="fa fa-plus" aria-hidden="true"></i></a>
                        </div>
                        <div class="panel-body" style="display:none;">
                            <table id="tb_products" style="width: 100%;border-collapse: collapse;margin-top:0px;" class="table-bordered striped3">
                                <thead style="background-color: #aad3ea">
                                    <tr>
                                        <th width="35%">NAME</th>
                                        <th width="5%" style="text-align:center;">STATUS</th>
                                        <th width="15%" style="text-align:center;">AVAILABLE FOR SIMPLY</th>
                                        <th width="10%" style="text-align:center;">PRICE</th>
                                        <th width="10%" style="text-align:center;">Type</th>
                                        <th width="5%" style="text-align:center;">Level</th>
                                        <th width="10%" style="text-align:center;"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        var SubscriptionIsDeactive = Products.Where(x => x.Product.Active != true);
                                    }
                                    @if (SubscriptionIsDeactive.Count() > 0)
                                    {
                                        foreach (var pr in SubscriptionIsDeactive)
                                        {
                                            <tr id="pr_@pr.Product.Id" class="@(pr.Product.Type !="other" ?"prd_collapse":"") hover">
                                                <td>
                                                    @if (pr.Product.Type != "other" && pr.Product.Type != "giftcard")
                                                    {
                                                        <a style="color: dodgerblue; margin: 0px 10px; padding: 0px;vertical-align:top;" class="icon_span btn fa fa-2x fa-plus-square-o"></a>
                                                        <a style="color: orange; margin: 0px 10px; padding: 0px; display: none;vertical-align:top;" class="icon_span btn fa fa-2x fa-minus-square-o"></a>
                                                    }
                                                    <div style="display:inline-block">
                                                        <b style="color:green" id="product_name_@pr.Product.Id" class="prod_name">@pr.Product.Name</b>
                                                        @if (pr.Product.isAddon != true)
                                                        {

                                                            if (string.IsNullOrEmpty(pr.Product.Code_POSSystem))
                                                            {
                                                                <label class="label label-success">version 2</label>
                                                            }
                                                            else
                                                            {
                                                                <label class="label label-warning">version 1</label>
                                                            }
                                                        }
                                                        <br />
                                                        @if (pr.Product.Trial_Months > 0)
                                                        {
                                                            <label class="label label-default">Allow Trial (@pr.Product.Trial_Months @(pr.Product.Trial_Months == 1?"month":"months"))</label>
                                                        }
                                                        @if (pr.Product.AllowSlice == true)
                                                        {
                                                            <label class="label label-default">Allow Slice</label>
                                                        }
                                                        @if (pr.Product.Promotion_Apply_Months > 0)
                                                        {
                                                            <label class="label label-default">Allow Promotion (@pr.Product.Promotion_Apply_Months @(pr.Product.Promotion_Apply_Months == 1?"month":"months"))</label>
                                                        }

                                                    </div>

                                                </td>
                                                <td style="text-align:center;">
                                                    <label class="switch on_row" style="vertical-align: text-top;">
                                                        <input id="status_@pr.Product.Id" type="checkbox" onchange="active_item(this,'@pr.Product.Id','@(@pr.Product.Active == true?"enable":"disable")')" @if (@pr.Product.Active == true) { @Html.Raw("checked") }>
                                                        <span class="slider round"></span>
                                                    </label>
                                                </td>
                                                <td style="text-align:center;">
                                                    <label class="switch on_row" style="vertical-align: text-top;">
                                                        <input id="available_@pr.Product.Id" type="checkbox" onchange="available_item(this,'@pr.Product.Id','@(@pr.Product.Available == true?"enable":"disable")')" @if (@pr.Product.Available == true) { @Html.Raw("checked") }>
                                                        <span class="slider round"></span>
                                                    </label>
                                                </td>
                                                <td style="text-align:center;">
                                                    @(pr.Product.Price != null ? string.Format("${0:#,0.00}", pr.Product.Price) : "N/A") /
                                                    <span>@(pr.Product.NumberOfPeriod == 1 ? "" : pr.Product.NumberOfPeriod?.ToString()) @(pr.Product.SubscriptionDuration != "MONTHLY" ? "times" : (string.IsNullOrEmpty(pr.Product.PeriodRecurring) ? "month" : pr.Product.PeriodRecurring.ToLower().Replace("ly", "")) + (pr.Product.NumberOfPeriod == 1 ? "" : "s"))</span>
                                                </td>
                                                <td style="text-align:center;">
                                                    @if (pr.Product.Type == "license")
                                                    {
                                                        <label class="label label-success">License</label>
                                                    }
                                                    else if (pr.Product.Type == "addon")
                                                    {
                                                        <label class="label label-warning">Addon</label>
                                                    }
                                                    else
                                                    {
                                                        <label class="label label-primary">Other services</label>
                                                    }
                                                </td>
                                                <td style="text-align:center;">
                                                    @if (pr.Product.Level == 0 || pr.Product.Level == null)
                                                    {
                                                        <text>
                                                            <label class="label label-default">N/A</label>
                                                        </text>
                                                    }
                                                    else
                                                    {
                                                        <label class="label label-success"> @pr.Product.Level</label>
                                                    }
                                                </td>
                                                <td style="text-align:center;">
                                                    <a onclick="edit_product('@pr.Product.Id', $(this))" class="btn btn-default fa fa-pencil text-green on_row" style="font-size:1.2em">
                                                        <img class="loading_img" src="~/Content/ajax-loaders/ajax-loader-1.gif" style="display:none" />
                                                    </a>
                                                    <a onclick="check_delete_product('@pr.Product.Id', $(this))" class="btn btn-default fa fa-trash-o text-red on_row" style="font-size:1.2em">
                                                        <img class="loading_img" src="~/Content/ajax-loaders/ajax-loader-1.gif" style="display:none" />
                                                    </a>
                                                </td>
                                            </tr>
                                            if (pr.Product.Type != "other" && pr.Product.Type != "giftcard")
                                            {
                                                <tr class="models_list" style="border-bottom: 1px double; display:none; background-color:#DDD">
                                                    <td colspan="7" style="padding-left:50px;border:none;">
                                                        <div style="border: 1px solid orange">
                                                            <table class="table table-bordered table-striped table-hover" style="margin:0px; background-color:#fff">

                                                                <tbody>
                                                                    @foreach (var group in Model.Where(g =>
                                                                    ((g.Group.Options.Contains("Product") && pr.Product.isAddon != true)
                                                                    || (g.Group.Options.Contains("Addon") && pr.Product.isAddon == true))
                                                                        && (g.Group.ID != 1000000 || (g.Group.ID == 1000000 && string.IsNullOrEmpty(pr.Product.Code_POSSystem)))))
                                                                    {
                                                                        <tr class="group_@group.Group.ID" style="background-color: #a3cbe2">
                                                                            <th colspan="3" onclick="edit_group('@group.Group.ID')">
                                                                                <div class="pull-left">
                                                                                    <h3 id="group_name_@group.Group.ID" class="pull-left" style="margin:0">@group.Group.Name</h3>
                                                                                </div>

                                                                            </th>
                                                                            <th></th>
                                                                        </tr>

                                                                        foreach (var item in group.Items)
                                                                        {
                                                                            var LP_item = pr.Items.Where(l => l.License_Item_Code == item.Code).FirstOrDefault();
                                                                            if (LP_item?.Enable == true)
                                                                            {
                                                                                <tr class="group_@group.Group.ID item" id="item_@item.ID">
                                                                                    <td></td>
                                                                                    <td></td>
                                                                                    <td>
                                                                                        <span id="item_name_@item.ID">@item.Name</span>
                                                                                    </td>

                                                                                    <td class="product_@pr.Product.Id" style="text-align:left; font-weight:bold">
                                                                                        <ul class="todo-list ui-sortable">
                                                                                            <li>
                                                                                                @*@item.Type :*@ @(item.Type == "FEATURE" ? (LP_item?.Value == 1 ? "Yes" : "No") : LP_item?.Value.ToString())
                                                                                            </li>
                                                                                        </ul>
                                                                                    </td>
                                                                                </tr>
                                                                            }
                                                                        }

                                                                        foreach (var childgroup in group.ChildGroups)
                                                                        {
                                                                            <tr class="group_@group.Group.ID group_@childgroup.Group.ID">
                                                                                <td></td>
                                                                                <td colspan="2" onclick="edit_group('@childgroup.Group.ID')">
                                                                                    <b id="group_name_@childgroup.Group.ID" class="pull-left">@childgroup.Group.Name</b>
                                                                                </td>
                                                                                <td></td>
                                                                            </tr>

                                                                            foreach (var item in childgroup.Items)
                                                                            {
                                                                                var LP_item = pr.Items.Where(l => l.License_Item_Code == item.Code).FirstOrDefault();
                                                                                if (LP_item?.Enable == true)
                                                                                {
                                                                                    <tr class="group_@group.Group.ID item" id="item_@item.ID">
                                                                                        <td></td>
                                                                                        <td></td>
                                                                                        <td>
                                                                                            <span id="item_name_@item.ID">@item.Name</span>
                                                                                        </td>

                                                                                        <td class="product_@pr.Product.Id" style="text-align:left; font-weight:bold">
                                                                                            <ul class="todo-list ui-sortable">
                                                                                                <li>
                                                                                                    @*@item.Type :*@ @(item.Type == "FEATURE" ? (LP_item?.Value == 1 ? "Yes" : "No") : LP_item?.Value.ToString())
                                                                                                </li>
                                                                                            </ul>
                                                                                        </td>
                                                                                    </tr>
                                                                                }
                                                                            }
                                                                        }
                                                                    }

                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="col-md-8 col-md-offset-2" id="div-btn-action-product-@pr.Product.Id" style="text-align:center; padding:10px">
                                                            </div>
                                                            <div class="col-md-2" style="padding:10px">
                                                                <button type="button" onclick="close_collapse()" class="btn btn-sm btn-default pull-right"><i class="fa fa-close"></i> Close</button>
                                                            </div>
                                                        </div>

                                                    </td>
                                                </tr>
                                            }

                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="7" class="text-center">
                                                No License Found !
                                            </td>
                                        </tr>
                                    }

                                </tbody>
                            </table>
                            <button type="button" style="margin-top:10px;float:right;" onclick="$('#deactive-panel').trigger('click');" class="btn btn-sm btn-default">Close</button>
                        </div>
                    </div>

                </div>
            </div>


        </div>
    </div>
</section>
<div class="modal fade in" id="product_popup" style="display: none;" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 id="modal-createorupdate-title" class="modal-title">Edit Product</h4>
            </div>
            <form id="product_form" action="/Licenses/Save_LicenseProduct" method="post">
                <div class="modal-body">
                    <input type="hidden" id="prd_id" name="Id" />
                    <input type="hidden" id="prd_code" name="Code" />
                    <div class="panel panel-default product-info-panel">
                        <div class="panel-heading">
                            <span>Product Information</span>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <label style="text-align:left;width:100%">Type Product <span style="color:red">*</span></label><br />
                                    <div class="form-group" style="width:100%;text-align:center;">
                                        <label style="cursor:pointer;">
                                            <input type="radio" name="Type" value="license" class="flat-red" checked>
                                            <span style=" transform: translateY(2px); display: inline-block; ">&nbsp;&nbsp;License </span>
                                        </label>
                                        <label style="margin-left:10px;cursor:pointer">
                                            <input type="radio" name="Type" value="addon" class="flat-red">
                                            <span style=" transform: translateY(2px); display: inline-block; ">&nbsp;&nbsp;Addon </span>
                                        </label>
                                        <label style="margin-left:10px;cursor:pointer">
                                            <input type="radio" name="Type" value="giftcard" class="flat-red">
                                            <span style=" transform: translateY(2px); display: inline-block; ">&nbsp;&nbsp;Gift Card </span>
                                        </label>
                                        <label style="margin-left:10px;cursor:pointer;">
                                            <input type="radio" name="Type" value="other" class="flat-red">
                                            <span style=" transform: translateY(2px); display: inline-block; ">&nbsp;&nbsp; Other Services </span>
                                        </label>
                                    </div>
                                    <script>
                                        $('input[type="radio"].flat-red').iCheck({
                                            radioClass: 'iradio_flat-blue',
                                        })
                                    </script>
                                </div>
                                <div class="col-md-12" style="padding-bottom:20px">
                                    <label>Name <span style="color:red">*</span></label>
                                    <input id="prd_name" name="Name" class="form-control" required />
                                </div>
                                <div class="col-md-6" style="padding-bottom:20px">
                                    <label>Payment Type <span style="color:red">*</span></label>
                                    <select id="prd_duration_prod" name="SubscriptionDuration" class="form-control">
                                        <option value="ONETIME">ONETIME</option>
                                        <option value="MONTHLY">TERM</option>
                                    </select>
                                </div>
                                <div class="col-md-6 period-div" style="padding-bottom:20px;display:none;">
                                    <label><span id="period-labeltext">Subscription Period</span> <span style="color:red"> *</span></label>
                                    <div class="input-group" style="width:100%">
                                        <input id="prd_period" style="width:50%" name="NumberOfPeriod" min="1" step="1" class="form-control" type="number" required />
                                        <select id="prd_periodrecurring" class="form-control" name="PeriodRecurring" style="width:50%">
                                            <option value="@RecurringInterval.Weekly.ToString()">@RecurringInterval.Weekly.ToString()</option>
                                            <option value="@RecurringInterval.Monthly.ToString()">@RecurringInterval.Monthly.ToString()</option>
                                            <option value="@RecurringInterval.Yearly.ToString()">@RecurringInterval.Yearly.ToString()</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6 quantity-gifcard-div" style="padding-bottom:20px;display:none;">
                                    <label><span id="quantity-gifcard-labeltext">Quantity</span> <span style="color:red"> *</span></label>
                                    <input id="quantity-gifcard" name="GiftCardQuantity" min="1" step="1" class="form-control" type="number" />
                                </div>
                                <div class="col-md-6" style="padding-bottom:10px">
                                    <label>Level</label>
                                    <select id="level" name="Level" class="form-control">
                                        <option value="">N/A</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                                <div class="col-md-6" style="padding-bottom:10px" id="Trial_Months-div">
                                    <label>Allow trial</label>
                                    <select id="trial_months" name="Trial_Months" class="form-control">
                                        <option value="0">N/A</option>
                                        <option value="1">1 Month</option>
                                        <option value="2">2 Months</option>
                                        <option value="3">3 Months</option>
                                        <option value="6">6 Months</option>
                                        <option value="12">12 Months</option>
                                    </select>
                                </div>
                                <div class="col-md-6" style="padding-bottom:10px" id="Partner-div">
                                    <label>Belong to partner</label>
                                    <select id="SiteId" name="SiteId" class="form-control">
                                        @foreach (var partner in partners)
                                        {
                                            <option value="@partner.SiteId">@(string.IsNullOrEmpty(partner.Code) ? "" : $"{partner.Code} - ")@partner.Name</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default product-info-panel">
                        <div class="panel-heading">
                            <span>Price</span>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-4" style="padding-bottom:20px">
                                    <label>Regular Price <span style="color:red">*</span></label>
                                    <div class="input-group">
                                        <span class="input-group-addon">$</span>
                                        <input id="prd_price" name="Price" min="0" class="form-control prd_price" type="number" required />
                                    </div>
                                </div>
                                <div class="col-md-4" style="padding-bottom:20px">
                                    <label>Partner Price</label>
                                    <div class="input-group">
                                        <span class="input-group-addon">$</span>
                                        <input id="prd_Partnerprice" name="PartnerPrice" min="0" class="form-control prd_Partnerprice" type="number" placeholder="N/A" />
                                    </div>
                                </div>
                                <div class="col-md-4" style="padding-bottom:20px">
                                    <label>Membership Price</label>
                                    <div class="input-group">
                                        <span class="input-group-addon">$</span>
                                        <input id="prd_Memprice" name="MembershipPrice" min="0" class="form-control prd_Memprice" type="number" placeholder="N/A" />
                                    </div>
                                </div>
                            </div>
                            <div class="row" id="license-activation">

                                <div class="col-md-4" style="padding-bottom:20px">
                                    <label>Preparing days</label>
                                    <input id="prd_PreparingDays" name="PreparingDays" min="0" step="1" class="form-control" type="number" placeholder="N/A" />
                                </div>
                            </div>
                        </div>
                    </div>
                    @*<div class="panel panel-default trial-panel">
                            <div class="panel-heading">
                                <span>Trial</span>
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-md-12" style="padding-bottom:10px" id="Trial_Months-div">
                                        <div style="display:flex;flex-wrap:nowrap;">
                                            <span style="line-height:30px;">Allow trial</span>
                                            <select id="trial_months" name="Trial_Months" style="width:110px;margin:0px 10px;" class="form-control">
                                                <option value="0">N/A</option>
                                                <option value="1">1 Month</option>
                                                <option value="2">2 Months</option>
                                                <option value="3">3 Months</option>
                                                <option value="6">6 Months</option>
                                                <option value="12">12 Months</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>*@
                    <div class="panel panel-default promotion-panel">
                        <div class="panel-heading">
                            <span>Promotion</span>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-4" style="padding-bottom:20px" id="Promotion_Price-div">
                                    <label>Promotion Price</label>
                                    <div class="input-group" style="display: flex;flex-wrap: wrap;position: relative;display: -ms-flexbox;display: flex;-ms-flex-wrap: wrap;flex-wrap: wrap;-ms-flex-align: stretch;align-items: stretch; width: 100%;">
                                        <div class="input-group-prepend" style="">
                                            <div class="input-group-text" style="display: flex;margin-right: -1px;border: 1px solid #d2d6de;padding: 6px 12px;">$</div>
                                        </div>
                                        <input id="Promotion_Price" name="Promotion_Price" type="number" min="0" class="form-control" style="display: block;position: relative;-ms-flex: 1 1 auto;flex: 1 1 auto;width: 1%;margin-bottom: 0;">
                                    </div>
                                </div>
                                <div class="col-md-4" style="padding-bottom:20px" id="Promotion_Apply_Months-div">
                                    <label>Promotion Apply Months</label>
                                    <select id="Promotion_Apply_Months" name="Promotion_Apply_Months" class="form-control">
                                        <option value="0">N/A</option>
                                        <option value="1">1 Month</option>
                                        <option value="2">2 Months</option>
                                        <option value="3">3 Months</option>
                                        <option value="6">6 Months</option>
                                        <option value="9">9 Months</option>
                                        <option value="12">12 Months</option>
                                    </select>
                                </div>
                                <div class="col-md-4" style="padding-bottom:10px" id="Promotion_Time_To_Available-div">
                                    <label>Available for license a least time</label>
                                    <select id="Promotion_Time_To_Available" name="Promotion_Time_To_Available" class="form-control">
                                        <option value="0">N/A</option>
                                        <option value="3">3 Months</option>
                                        <option value="6">6 Months</option>
                                        <option value="12">12 Months</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default activation-panel">
                        <div class="panel-heading">
                            <span>Surcharge - Initialization fee</span>
                        </div>
                        <div class="panel-body">
                            <div class="row">

                                <div class="col-md-6" style="padding-bottom:20px">
                                    <label>Activation Fee</label>
                                    <div class="input-group">
                                        <span class="input-group-addon">$</span>
                                        <input id="prd_ActivationFee" name="ActivationFee" min="0" class="form-control prd_ActivationFee" type="number" placeholder="N/A" />
                                    </div>
                                </div>

                                <div class="col-md-6" style="padding-bottom:20px">
                                    <label>Interaction Fee</label>
                                    <div class="input-group">
                                        <span class="input-group-addon">$</span>
                                        <input id="prd_InteractionFee" name="InteractionFee" min="0" class="form-control prd_InteractionFee" type="number" placeholder="N/A" />
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="panel panel-default status-panel">
                        <div class="panel-heading">
                            <span>Status</span>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-6" style="padding-bottom:10px" id="Active-div">
                                    <div class="form-group row" style="margin:0px">
                                        <label for="active" class="col-sm-3 col-form-label" style="padding:0px;margin-bottom:0px">Active</label>
                                        <div class="col-sm-9" style="padding:0px;">
                                            <input name="Active" id="active" value="true" type="checkbox" class="minimal" checked>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6" style="padding-bottom:10px" id="">
                                    <div class="form-group row" style="margin:0px">
                                        <label for="prd_auto_Tiket" class="col-sm-9 col-form-label" style="padding:0px;margin-bottom:0px">Auto create deployment ticket</label>
                                        <div class="col-sm-3" style="padding:0px;">
                                            <input id="prd_auto_Tiket" name="DeploymentTiketAuto" value="true" type="checkbox" class="minimal" checked>
                                        </div>
                                    </div>
                                </div>
                                @*<script>
                                        $('input[type="checkbox"].minimal').iCheck({
                                            checkboxClass: 'icheckbox_minimal-blue',
                                        })
                                    </script>*@
                                <div class="col-md-6" id="Available-div">
                                    <div class="form-group row" style="margin:0px">
                                        <label for="Available" class="col-sm-6 col-form-label" style="padding:0px;">Available for simply</label>
                                        <div class="col-sm-6" style="padding-left:5px">
                                            <label class="switch" style="vertical-align: middle;margin-bottom:0px;">
                                                <input id="available" type="checkbox" value="true" name="Available" checked>
                                                <span class="slider round"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6" style="padding-bottom:10px" id="FlagDeactivateExpires-div">
                                    <div class="form-group row" style="margin:0px">
                                        <label for="prd_FlagDeactivateExpires" class="col-sm-9 col-form-label" style="padding:0px;margin-bottom:0px">Allow deactive when expires</label>
                                        <div class="col-sm-3" style="padding:0px;">
                                            <input id="prd_FlagDeactivateExpires" name="bool_FlagDeactivateExpires" value="true" type="checkbox" class="minimal">
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-md-12 for-product" style="display:none">
                        <label>POS LICENSE </label>
                        <select name="Code_POSSystem" class="form-control" required>
                            <option value="MANGOONE">SIMPLY ONE</option>
                            <option value="MANGOPLUS">SIMPLY PLUS</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">
                        Save <img id="loading" src="/Content/ajax-loaders/ajax-loader-1.gif" style="display:none">
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade in" id="cant_delete_popup" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 class="modal-title">
                    This License has been activated for some salons. You cannot delete!
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <a id="btn_show" onclick="$('#list_merchant').slideDown(200), $(this).hide()"> + Show more...</a>
                        <div id="list_merchant" style="display:none">
                            <table class="table table-hover">
                                <thead style="background-color: #c2e1f3">
                                    <tr>
                                        <th>Merchant #</th>
                                        <th>Store #</th>
                                        <th>Detail</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        <button type="button" class="btn btn-default pull-right" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="select_item_modal_div"></div>
<div id="store_actived_modal_div"></div>

<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script type="text/javascript">
    $(function () {
        $('input[type="checkbox"].minimal').iCheck({
            checkboxClass: 'icheckbox_minimal-blue',
        })
        $("input[name=version]").on("change", function () {
            var ver = $("input[name=version]:checked").val();
            var TypeProduct = $("[name=Type]").val();
            if (ver == "1" && TypeProduct == 'license') {
                $("[name=Code_POSSystem]").prop("disabled", "").closest(".for-product").show();
                $("[name=AllowDemo]").prop("disabled", "disabled").closest(".for-version2").hide();
            } else {
                $("[name=Code_POSSystem]").prop("disabled", "disabled").closest(".for-product").hide();
                $("[name=AllowDemo]").prop("disabled", "").closest(".for-version2").show();
            }
        })

        $("#prd_duration_prod").on('change', function () {
            if ($("#prd_duration_prod").val() == "MONTHLY") $("#FlagDeactivateExpires-div").show();
            else $("#FlagDeactivateExpires-div").hide();
        })
    })
    function UpdatePopupByType(TypeProduct) {
        switch (TypeProduct) {
            case 'license':
                $("#prd_duration_prod").val("MONTHLY");
                $("#prd_duration_prod").css("pointer-events", "none");
                $("#prd_duration_prod").attr("readonly", true);
                $("#select_version_radio").show();
                $("#Trial_Months-div").show();
                $("#Partner-div").show();
                $(".activation-panel").show();
                $("#Promotion_Apply_Months-div").show();
                $("#Promotion_Price-div").show();
                $(".trial-panel").show();
                $(".promotion-panel").show();
                $(".quantity-gifcard-div").hide();
                $('#license-activation').show();
                break;
            case 'addon':
                //$("#prd_duration_prod").val("ONETIME");
                //$("#prd_duration_prod").attr("readonly", true);
                //$("#prd_duration_prod").css("pointer-events", "none");
                $("#prd_duration_prod").css("pointer-events", "unset");
                $("#prd_duration_prod").attr("readonly", false);
                $("#select_version_radio").hide();
                $("#Trial_Months-div").hide();
                $(".activation-panel").hide();
                $("#Promotion_Apply_Months-div").hide();
                $("#Promotion_Price-div").hide();
                $(".trial-panel").hide();
                $(".promotion-panel").hide();
                $(".quantity-gifcard-div").hide();
                $('#license-activation').hide();
                $("#Partner-div").hide();
                break;
            case 'giftcard':
                $("#prd_duration_prod").val("ONETIME");
                $("#prd_duration_prod").attr("readonly", true);
                $("#prd_duration_prod").css("pointer-events", "none");
                //$("#prd_duration_prod").css("pointer-events", "unset");
                //$("#prd_duration_prod").attr("readonly", false);
                $("#select_version_radio").hide();
                $("#Trial_Months-div").hide();
                $(".activation-panel").hide();
                $("#Promotion_Apply_Months-div").hide();
                $("#Promotion_Price-div").hide();
                $(".trial-panel").hide();
                $(".promotion-panel").hide();
                $(".quantity-gifcard-div").show();
                $('#license-activation').hide();
                $("#Partner-div").hide();
                break;
            case 'other':
                $("#prd_duration_prod").css("pointer-events", "unset");
                $("#prd_duration_prod").attr("readonly", false);
                $("#select_version_radio").hide();
                $("#Trial_Months-div").hide();
                $(".activation-panel").hide();
                $("#Promotion_Apply_Months-div").hide();
                $("#Promotion_Price-div").hide();
                $(".trial-panel").hide();
                $(".promotion-panel").hide();
                $(".quantity-gifcard-div").hide();
                $('#license-activation').hide();
                $("#Partner-div").hide();
                break;
        }
        var ver = $("input[name=version]:checked").val();
        if (TypeProduct == "license" && ver == "1") {
            $("[name=Code_POSSystem]").prop("disabled", "").closest(".for-product").show();
        }
        else {
            $("[name=Code_POSSystem]").prop("disabled", "disabled").closest(".for-product").hide();
        }
        if ($('#prd_duration_prod').val() == "MONTHLY") {
            $('.period-div').show();
            $("#FlagDeactivateExpires-div").show();
        }
        else {
            $('.period-div').hide();
            $("#FlagDeactivateExpires-div").hide();
        }
    }

    $("[name=Type]").on("ifChanged", function () {
        var TypeProduct = $(this).val();
        $("#prd_duration_prod").val("ONETIME");
        UpdatePopupByType(TypeProduct);
    })
    $("[name=SubscriptionDuration]").on("change", function () {
        TypeProduct = $('input[name=Type]:checked', '#product_form').val()
        if ($('#prd_duration_prod').val() == "MONTHLY") {
            $('.period-div').show();
        }
        else {
            $('.period-div').hide();
        }
    })
    function show_modal(productId, itemId) {
        $.ajax({
            method: "POST",
            url: "/Licenses/Load_LicenseProductItem",
            data: { productId, itemId },
            dataType: "json"
        })
            .done(function (data) {
                $("#LP_Item").resetForm();
                $("#popup").find(".modal-title").html(data[2] + " - " + data[3]);
                //Edit format form
                if (data[0] == "ONETIME") {
                    $(".one_time").show().find(".form-control").removeAttr("disabled");
                    $(".subscrip").hide().find(".form-control").attr("disabled", true);
                    $("#subscription_check").hide();
                } else {
                    $(".one_time").hide().find(".form-control").attr("disabled", true);
                    $(".subscrip").show().find(".form-control").removeAttr("disabled");
                    $("#subscription_check").show();
                    if (data[1].PeriodAmount > 0) {
                        $("#pa_1").prop('checked', true).trigger("click");
                    } else {
                        $("#pa_0").prop('checked', true).trigger("click");
                    }
                }
                if (data[5] == "FEATURE") {

                    $(".count").hide().find(".form-control").attr("disabled", true);
                    if (data[0] == "ONETIME") {
                        $(".no_count").css("width", "100%");
                    } else {
                        $(".no_count").css("width", "");
                    }
                } else {
                    $(".count").show().find(".form-control").removeAttr("disabled");
                    $(".no_count").css("width", "");
                }
                //Set value
                $("#productId").val(productId);
                $("#itemType").val(data[0]);
                $("#period").val(data[4]);
                $("#enable_item").prop("checked", data[1].Id != null);
                $.each(data[1], function (key, value) {
                    var input = $("#LP_Item").find("[name=" + key + "]");
                    if (input.attr("type") == "checkbox") {
                        input.attr("checked", value);
                    } else
                        if (value)
                            input.val(value);
                });


                $("#popup").modal("show");
            })
            .fail(function () {
                alert("load_addon_table failure");
            })
            .always(function () {
            });

    }
    $("#LP_Item").ajaxForm(function (data) {
        if (data[0]) {
            noty({ "text": data[1], "layout": "topRight", "type": "success" });
            load_tab();
            $("#popup").modal("hide");
        } else {
            noty({ "text": data[1], "layout": "topRight", "type": "error" });
        }
    });

    function edit_product(id, e) {
        $("#modal-createorupdate-title").html("Edit Product");
        e.find(".loading_img").show();
        $.ajax({
            method: "POST",
            url: "/Licenses/getLicenseProduct",
            data: { id },
            dataType: "json"
        })
            .done(function (data) {
                if (data[0]) {
                    $("#product_form").find("[type=hidden]").val("");
                    $("#product_form").resetForm();
                    $.each(data[2], function (key, value) {
                        if ($("[name=" + key + "]").not("[name=Type]").attr("type") == "checkbox") {
                            $("[name=" + key + "]").not("[name=Type]").attr("checked", value);
                        }
                        else
                            $("[name=" + key + "]").not("[name=Type]").val(value);
                    });

                    //$("[name=Type]").prop("disabled", true);
                    $('[name=Type][value=' + data[2].Type + ']').prop("checked", true);
                    //$('[name=Type][value=' + data[2].Type + ']').prop("disabled", false);
                    $('[name=Type]').iCheck('update');
                    $("#prd_id").val(data[1]);
                    $("#prd_price").val(data[2].Price);
                    $("#prd_period").val(data[2].NumberOfPeriod);
                    $("#prd_periodrecurring").val(data[2].PeriodRecurring ?? 'Monthly');
                    $("#trial_months").val(data[2].Trial_Months);
                    $("#Promotion_Apply_Months").val(data[2].Promotion_Apply_Months);
                    $("#Promotion_Price").val(data[2].Promotion_Price);
                    $('#Promotion_Price').attr("max", data[2].Price);
                    $('#Promotion_Time_To_Available').val(data[2].Promotion_Time_To_Available);
                    $("#level").val(data[2].Level);
                    $("#SiteId").val(data[2].SiteId ?? 1);
                    if (data[2].Available) {
                        $("#available").attr("checked", true);
                    } else {
                        $("#available").attr("checked", false);
                    }
                    if (data[2].DeploymentTiketAuto) {
                        $("#prd_auto_Tiket").attr("checked", true);
                    } else {
                        $("#prd_auto_Tiket").attr("checked", false);
                    }

                    if (data[2].SubscriptionDuration != "MONTHLY") {
                        $("#FlagDeactivateExpires-div").hide();
                    }
                    else {
                        $("#FlagDeactivateExpires-div").show();
                    }

                    if (data[2].FlagDeactivateExpires) {
                        $("#prd_FlagDeactivateExpires").attr("checked", true);
                    } else {
                        $("#prd_FlagDeactivateExpires").attr("checked", false);
                    }
                    if (data[2].Active) {
                        $("#active").attr("checked", true);
                    } else {
                        $("#active").attr("checked", false);
                    }
                    $('[name=bool_FlagDeactivateExpires]').iCheck('update');
                    $('[name=DeploymentTiketAuto]').iCheck('update');
                    $('[name=Active]').iCheck('update');
                    if (data[2].Code_POSSystem) {
                        $("[name=version][value=1]").prop("checked", "checked").trigger("change");
                    }
                    else {
                        $("[name=version][value=2]").prop("checked", "checked").trigger("change");
                    }
                    //if (data[2].AllowDemo == true) {
                    //    $("[name=allowdemo][value=true]").prop("checked", "checked").trigger("change");
                    //}
                    //if (data[2].AllowSlice == true) {
                    //    $("[name=allowslice][value=true]").prop("checked", "checked").trigger("change");
                    //}
                    $("#prd_duration_prod").val(data[2].SubscriptionDuration === "MONTHLY" ? "MONTHLY" : "ONETIME");
                    UpdatePopupByType(data[2].Type);
                    $("#product_popup").modal("show");

                } else {
                    noty({ "text": data[1], "layout": "topRight", "type": "error" });
                }
            })
            .fail(function () {
                alert("edit_group falure");
            })
            .always(function () {
                e.find(".loading_img").hide();
            });
    }
    function check_delete_product(id, e) {
        var name = $('#product_name_' + id).html();
        var mess = 'Do you want to delete product "' + name + '"?';
        $.ajax({
            method: "POST",
            url: "/Licenses/CheckDeleteProduct",
            data: { id },
            dataType: "json"
        })
            .done(function (data) {
                if (data[0]) {
                    if (data[1]) {
                        mess = 'The license has been activated for some salons.\n' + mess;
                        //var s_list = "";
                        //for (var i in data[1]) {
                        //    s_list += "<tr onclick=\"window.open('/merchantman/detail?code=" + data[1][i].Code + "&tab=services', '_blank');\" target='_blank'><td><b class='text-primary'>#" + data[1][i].Code + "</b></td><td>#" + data[1][i].Store + "</td><td><b class='text-success'>" + (data[1][i].Name || "") + "</b><br/>" + data[1][i].Address + "</td> </tr>";
                        //}
                        //$("#list_merchant").find("tbody").html(s_list);
                        //$('#btn_show').show(); $('#list_merchant').hide();
                        //$("#cant_delete_popup").modal("show");
                    }
                    delete_product(id, e, mess);
                } else {
                    noty({ "text": data[1], "layout": "topRight", "type": "error" });
                }
            })
            .fail(function () {
            })
            .always(function () {
                e.find(".loading_img").hide();
            });


    }
    function delete_product(id, e, mess) {
        if (confirm(mess)) {
            e.find(".loading_img").show();
            $.ajax({
                method: "POST",
                url: "/Licenses/DeleteProduct",
                data: { id },
                dataType: "json"
            })
                .done(function (data) {
                    if (data[0]) {
                        noty({ "text": data[1], "layout": "topRight", "type": "success" });
                        load_tab();
                    } else {
                        noty({ "text": data[1], "layout": "topRight", "type": "error" });
                    }
                })
                .fail(function () {
                })
                .always(function () {
                    e.find(".loading_img").hide();
                });

        }
    }
    function new_product() {
        $("#modal-createorupdate-title").html("Create Product");
        $("#product_form").resetForm();
        $("#product_form").find("[type=hidden]").val("");
        $("[name=Type]").removeAttr("disabled");
        var current = localStorage.getItem('lastTabLicense');
        $('[name=Type][value=' + current + ']').prop("checked", true);
        $('[name=Type]').iCheck('update');
        $(".pro_desc").hide("300").find(".form-control").attr("disabled", true);
        $("#product_popup").modal("show");
        $("#prd_duration_prod").val("MONTHLY");
        $("#prd_duration_prod").css("pointer-events", "none");
        $("#prd_duration_prod").attr("readonly", true);
        $("#select_version_radio").show();
        $("#Trial_Months-div").show();
        $("#Promotion_Apply_Months-div").show();
        $("#Promotion_Price-div").show();
        $("#prd_period").val(1);
        $("#prd_duration_prod").val("ONETIME");
        $('input[name=bool_FlagDeactivateExpires]').prop("checked", false);
        $('[name=bool_FlagDeactivateExpires]').iCheck('update');
        UpdatePopupByType(current);
    }

    function show_select_item(ProductId, e, update = false) {
        $(e).find(".loading_img").show();
        $.ajax({
            method: "POST",
            url: "/Licenses/SelectItemModal_Partial",
            data: { ProductId, update },
            dataType: "html"
        })
            .done(function (data) {
                $("#select_item_modal_div").html(data);
                $("[name=ProductId]").val(ProductId);
                $("#select_item_modal").find(".modal-title").html(update ? "Update Product Licenses Item" : "Add Product Licenses Item");
                $("#update").val(update);
                $("#select_item_modal").modal("show");
            })
            .fail(function () {
                alert("show_select_item failure");
            })
            .always(function () {
                $(e).find(".loading_img").hide();
            });
    }
    load_event();
    function load_event() {
        $(".on_row").on('click', function (event) {
            event.stopPropagation();
        })
        $("th,td").not(".models_list> td").hover(
            function () {
                $(this).find(".btn_group").css({ opacity: 0.0, visibility: "visible" }).animate({ opacity: 1.0 });
            },
            function () {
                $(this).find(".btn_group").css({ opacity: 0.0, visibility: "hidden" }).animate({ opacity: 1.0 });
            }
        );
        $("#Type").on("change", function () {
            if (this.value != "license") {
                $(".pro_desc").hide("300").find(".form-control").attr("disabled", true);
            }
            else {
                $(".pro_desc").show("300").find(".form-control").removeAttr("disabled");
            }
        });
        $(".prd_collapse").on("click", function () {
            $(this).find(".icon_span").toggle();
            $(this).next("tr").toggle(100);
            if (!$(this).hasClass("actived")) {
                $(".prd_collapse.actived").find(".icon_span").toggle();
                $(".prd_collapse.actived").removeClass("actived").next("tr").hide();
            }
            $(this).toggleClass("actived");
        });
    }
    function close_collapse() {
        $(".prd_collapse.actived").find(".icon_span").toggle();
        $(".prd_collapse.actived").removeClass("actived").next("tr").hide();
    }
    function show_stores_actived(productId, reUpdate, e) {
        if (!reUpdate) {
            $.ajax({
                method: "GET",
                url: "/Licenses/CreateHistoryStoreActivedProduct",
                data: { productId },
                dataType: "html"
            });
        }

        $(e).find(".loading_img").show();
        $.ajax({
            method: "POST",
            url: "/Licenses/GetStoresActivedProduct_Partial",
            data: { productId, reUpdate },
            dataType: "html"
        })
            .done(function (data) {
                $('#store_actived_modal_div').html(data);
                $("#store_actived_modal").modal();
            })
            .fail(function () {
                alert("show stores actived failure");
            })
            .always(function () {
                $(e).find(".loading_img").hide();
            });
    }
    $('#prd_price').change(function () {
        $('#Promotion_Price').attr("max", $('#prd_price').val());
    });
    $("#product_form").ajaxForm(function (data) {
        $('#loading').show();
        if (data[0]) {
            noty({ "text": data[1], "layout": "topRight", "type": "success" });
            load_tab();
            $("#product_popup").modal("hide");
        } else {
            noty({ "text": data[1], "layout": "topRight", "type": "error" });
        }
        $('#loading').hide();
    });
    function available_item(element, ProductId, type) {
        var curentval = !$(element).prop("checked");
        console.log(curentval);
        var text = '';
        if (type == "enable") {
            text = 'Are you sure to disable this license on simply !';
        }
        else {
            text = 'Are you sure to enable this license on simply !';
        }
        if (confirm(text)) {

            $.ajax({
                method: "POST",
                url: "/Licenses/EnableAvaible",
                data: { productId: ProductId },
                dataType: "Json"
            })
                .done(function (data) {
                    if (data.status) {
                        noty({ "text": data.message, "layout": "topRight", "type": "success" });
                    }
                    else {
                        noty({ "text": data.message, "layout": "topRight", "type": "error" });
                    }
                })
                .fail(function () {
                    alert("update license fail !");
                })
                .always(function () {
                    load_tab();
                });
        }
        else {
            $(element).prop("checked", curentval);
        }
    }
    function active_item(element, ProductId, type) {
        var curentval = !$(element).prop("checked");
        console.log(curentval);
        var text = '';
        if (type == "enable") {
            text = 'Are you sure to disable this license !';
        }
        else {
            text = 'Are you sure to enable this license !';
        }
        if (confirm(text)) {

            $.ajax({
                method: "POST",
                url: "/Licenses/EnableStatus",
                data: { productId: ProductId },
                dataType: "Json"
            })
                .done(function (data) {
                    if (data.status) {
                        noty({ "text": data.message, "layout": "topRight", "type": "success" });
                    }
                    else {
                        noty({ "text": data.message, "layout": "topRight", "type": "error" });
                    }
                })
                .fail(function () {
                    alert("update license fail !");
                })
                .always(function () {
                    load_tab();
                });
        }
        else {
            $(element).prop("checked", curentval);
        }
    }
    function togglePanel(el) {
        var panelbody = $(el).parent().children('.panel-body');
        var btnicon = $(el).children('.icon');
        if ($(panelbody).is(':visible')) {
            $(panelbody).slideUp();
            $(btnicon).html('<i class="fa fa-plus" aria-hidden="true"></i>');
        }
        else {
            $(panelbody).slideDown();
            $(btnicon).html('<i class="fa fa-minus" aria-hidden="true"></i>');
        }
    }
</script>

<style type="text/css">
    table.table-bordered {
        border: 1px solid lightgray;
        margin-top: 20px;
    }

        table.table-bordered > thead > tr > th {
            border: 1px solid lightgray;
        }

        table.table-bordered > tbody > tr > td {
            border: 1px solid lightgray;
        }

    tr td, tr th {
        border-top: solid 1px #ddd;
        padding: 10px;
        cursor: pointer;
    }

    tr.hover:hover {
        background-color: #ddd !important;
    }

    .striped3 > tbody > tr:nth-of-type(4n+3) {
        background-color: #eee;
    }

    .striped3 > tbody > tr:nth-of-type(4n+4) {
        background-color: #eee;
    }

    .btn.btn-warning.toggle-off {
        color: #fff !important;
    }
</style>


