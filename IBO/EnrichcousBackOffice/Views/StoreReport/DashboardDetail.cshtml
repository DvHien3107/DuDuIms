@using EnrichcousBackOffice.Models
@using EnrichcousBackOffice.Utils.IEnums
@using EnrichcousBackOffice.AppLB
@using Inner.Libs.Helpful;
@{
    ViewBag.Title = "Dashboard Detail";
    //var host = $"{HttpContext.Current.Request.Url.Scheme}://{HttpContext.Current.Request.Url.Authority}";

    //var Partners = ViewBag.Partners as List<C_Partner>;

    //var Services = ViewBag.Services as List<License_Product> ?? new List<License_Product>() { };
    //var Hardware = ViewBag.Hardware as List<O_Product_Model> ?? new List<O_Product_Model>() { };
    //var gr_Services = Services.GroupBy(c => c.Type).Select(c => new
    //{
    //    Type = c.Key,
    //    Service = c.ToList()
    //}).OrderByDescending(c => c.Type == "license").ThenBy(c => c.Type == "other").ToList();
}

@*<link href="~/Content/Admin/bower_components/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet" />*@
<style>
    .ico-help {
        display: inline-block;
        transform: translateY(1px);
        color: var(--main-color-1);
        font-size: 1em;
        padding-left: 1px;
    }

    .total-div {
        display: inline-block;
        border: 1px dotted green;
        padding: 5px 10px;
        margin-right: 3px;
    }

    .vertical-middle {
        vertical-align: middle !important;
    }
    /* .select2-selection__choice {
        float: none !important;
        display: inline-block !important;
    }*/

</style>
<section class="content-header">
    <h1>
        <b class="monthTitle"></b> Dashboard Detail
    </h1>
    <ol class="breadcrumb">
        <li><a href="/home"><i class="fa fa-dashboard"></i> Home</a></li>
        <li>Dashboard</li>
        <li>Dashboard Detail</li>
    </ol>
</section>

<section class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">Detail</h3>
                </div>
                <div class="box-body">
                    <div class="total-wrapper" style="text-align:right;font-size:19px;font-weight:bold;">
                        <div class="total-div" style="display:inline-block;"><span>Num. Of Store: </span><span style="display:inline-block;min-width:20px;text-align:left;" id="total-record"> 0</span></div>

                    </div>
                    <div>
                        <table class="table table-bordered table-hover data-transaction" style="width:100%">


                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="dataTables_scroll">
                                        <div class="dataTables_scrollBody" style="position: relative; overflow: auto; width: 100%;">
                                            <table class="table table-bordered table-hover data-transaction dataTable no-footer" style="width: 100%;" id="DataTables_Table_0" role="grid">
                                                <thead>
                                                    <tr role="row" style=" ">
                                                        <th class="vertical-middle sorting_disabled" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" style="width: 206.156px; padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px;  " aria-label="Transaction Date: activate to sort column descending"
                                                            aria-sort="descending">
                                                            <div class="dataTables_sizing" style="  overflow: hidden;">Store Code</div>
                                                        </th>
                                                        <th class="vertical-middle sorting_disabled" rowspan="1" colspan="1" style="width: 165.453px; padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px;  " aria-label="Salon Name">
                                                            <div class="dataTables_sizing" style="  overflow: hidden;">Name</div>
                                                        </th>
                                                        <th class="vertical-middle sorting_disabled" rowspan="1" colspan="1" style="width: 91.4062px; padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px;  " aria-label="Invoice">
                                                            <div class="dataTables_sizing" style="  overflow: hidden;">Phone</div>
                                                        </th>
                                                        <th class="vertical-middle sorting_disabled" rowspan="1" colspan="1" style="width: 221.609px; padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px;  " aria-label="Discount For Invoice">
                                                            <div class="dataTables_sizing" style="  overflow: hidden;">Address</div>
                                                        </th>
                                                        <th class="vertical-middle sorting_disabled" rowspan="1" colspan="1" style="width: 212.125px; padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px;  " aria-label="Subscription Name">
                                                            <div class="dataTables_sizing" style="  overflow: hidden;">Country</div>
                                                        </th>
                                                        <th class="vertical-middle sorting_disabled" rowspan="1" colspan="1" style="width: 67.1719px; padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px;  " aria-label="Price">
                                                            <div class="dataTables_sizing" style="  overflow: hidden;">Email</div>
                                                        </th>
                                                        <th class="vertical-middle sorting_disabled" rowspan="1" colspan="1" style="width: 106.938px; padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px;  " aria-label="Discount">
                                                            <div class="dataTables_sizing" style="  overflow: hidden;">Create By</div>
                                                        </th>
                                                        <th class="vertical-middle sorting_disabled" rowspan="1" colspan="1" style="width: 120.984px; padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px;  " aria-label="Total Price">
                                                            <div id="txtFrstInvDate" class="dataTables_sizing" style="  overflow: hidden;">First Inv Date</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody id="dashboardDetaildata">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div id="DataTables_Table_0_processing" class="dataTables_processing panel panel-default" style="display: none;"><img src="/Content/ajax-loaders/loading2.gif" width="60px"></div>
                                </div>
                            </div>


                        </table>
                    </div>

                </div>
            </div>
        </div>
    </div>
</section>
<div class="modal fade" id="Invoice" role="dialog" style="display: none;">
    <div class="modal-dialog modal-content" style="min-width:900px">
        <div class="modal-header">
            <div class="modal-title pull-left"><h3 style="margin:0">View Invoice</h3></div>
            <button type="button" class="btn btn-sm btn-warning" style="float:left; margin-left:20px" onclick="document.getElementById('invoice-view').contentWindow.print()"><i class="fa fa-print"></i> Print</button>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
        </div>
        <div class="modal-body" style="padding:1px;height: 77vh;">
            <iframe width="100%" height="100%" style="border: none;" id="invoice-view" data-src="/order/ImportInvoiceToPDF?_code=%code%&amp;flag=Invoice"></iframe>
        </div>
    </div>
</div>
<script src="~/Content/Admin/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<link href="~/Content/Selectize/css/selectize.default.css" rel="stylesheet" />
<script src="~/Content/Selectize/js/standalone/selectize.min.js"></script>
<script src="//cdn.rawgit.com/ashl1/datatables-rowsgroup/v1.0.0/dataTables.rowsGroup.js"></script>
@section script{
    <script>
        var params = searchToObject();
        if (params.type == 'CANCEL') {
            $('#txtFrstInvDate').html('Cancel Date')
        }

        $('.monthTitle').html(moment(params.month, 'MM').format('MMMM'));

        axiosConsole.loadDashboardDetail(params.month, params.year, params.type, function (data) {
            console.log(data)

            let row = '';
            for (let i = 0; i < data.length; i++) {
                if (params.type == 'CANCEL') { 
                    data[i].FirstInvDate = data[i].CancelDate
                }
                row += `<tr role="row" class="even row_transaction">
                                                        <td class="vertical-middle sorting_1" rowspan="1">${data[i].StoreCode}</td>
                                                        <td class="vertical-middle sorting_2" rowspan="1">
                                                            <a target="_blank" href="/merchantman/detail/${data[i].Id}"><strong class="text-info">#${data[i].BusinessName}</strong></a> 
                                                        </td>
                                                        <td class="vertical-middle sorting_3" rowspan="1"><a class="label label-default"><b>${data[i].BusinessPhone} </b></a></td>
                                                        <td class=" vertical-middle">${data[i].BusinessAddress}</td>
                                                        <td class=" vertical-middle"> <span>${data[i].BusinessCountry} </span></td>
                                                        <td class=" vertical-middle">${data[i].MangoEmail}</td>
                                                        <td class=" vertical-middle"><b>${data[i].CreateBy}</b></td>
                                                        <td class=" vertical-middle"><span class="label label-primary">${moment(data[i].FirstInvDate).format('MMM DD,YYYY')}</span></td>
                                                    </tr>`;
            }
            $('#dashboardDetaildata').html(row)
            $('#total-record').text(data.length)
        })
        $('.data-transaction')
    </script>
}
