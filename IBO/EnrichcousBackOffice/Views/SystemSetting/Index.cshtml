@model EnrichcousBackOffice.Models.SystemConfiguration

@{
    ViewBag.Title = "Company infomation";

    string picture;
    if (string.IsNullOrWhiteSpace(Model.Logo))
    {
        picture = "/Upload/Img/no_image.jpg";
    }
    else
    {
        picture = Model.Logo;
    }

    string picturepro;
    if (string.IsNullOrWhiteSpace(Model.ProductLogo))
    {
        picturepro = "/Upload/Img/no_image.jpg";
    }
    else
    {
        picturepro = Model.ProductLogo;
    }
    System.Collections.ObjectModel.ReadOnlyCollection<TimeZoneInfo> tz = TimeZoneInfo.GetSystemTimeZones();
}

<section class="content-header">
    <h1>
        Setting
        <small>Company infomation</small>HR email
    </h1>
    <ol class="breadcrumb">
        <li><a href="/quanly/home/"><i class="fa fa-dashboard"></i> Dashboard</a></li>
        <li><a href="javascript:void(0)"><i class="fa fa-cogs"></i>Setting</a></li>
        <li class="active">@ViewBag.Title</li>
    </ol>
</section>
<style>
    #table_optional td {
        padding: 10px 0px;
    }
</style>
<!-- Main content -->
<section class="content">
    <div class="row">
        @if (TempData["error"] != null)
        {
            <div class="alert alert-warning alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                <span><i class="icon fa fa-warning"></i> @TempData["error"]</span>
            </div>
        }
        else if (TempData["success"] != null)
        {
            <div class="alert alert-success alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                <span><i class="icon fa fa-check"></i> @TempData["success"]</span>
            </div>
        }


        <div class="col-md-12">
            <div class="">
                @*<div class="box-header with-border">
                        <h3 class="box-title">@ViewBag.Title</h3>
                    </div>*@
                <form role="form" class="form-horizontal" action="/systemsetting/save/" method="post" enctype="multipart/form-data">
                    @Html.AntiForgeryToken()
                    @Html.HiddenFor(m => m.Id)
                    <div class="nav-tabs-custom" style="margin-bottom:0">
                        <ul class="nav nav-tabs" id="main_tab">
                            <li id="settings" class="active"><a data-tab="#settings_tab" style="cursor: pointer;" data-toggle="tab" aria-expanded="true"><h3 style="margin:0">Company settings</h3></a></li>
                            <li id="optionals" class=""><a data-tab="#optionals_tab" style="cursor: pointer;" data-toggle="tab" aria-expanded="false"><h3 style="margin:0">Optionals</h3></a></li>
                            <li id="optionals" class="optionals_tab_label"><a data-tab="#optinon_config" style="cursor: pointer;" data-toggle="tab" aria-expanded="false"><h3 style="margin:0">System Configuration</h3></a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active">
                                <div style="text-align:center">
                                    <img id="load_partial_tab" src="/Content/ajax-loaders/loading-partial.gif" style="display: none;">
                                </div>
                                <div id="settings_tab" class="main_tab" style="min-height:300px;">
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Company logo</label>
                                            <div class="col-sm-9">
                                                <input type="file" id="pic0" name="pic0" onchange="reviewUpload(this)" />
                                                <div style="padding-left:0px;display:block" class="col-sm-12" id="review_pic0">
                                                    <p class="col-sm-12" style="border:1px dotted red; padding:3px">
                                                        <img id="img_pic0" src="@picture" style="height:100px;margin-left:0" alt="preview" />
                                                        <i style="padding-left:5px" id="fname_pic0"></i>
                                                        <a onclick="upload_delete('pic0')" href="#" data-toggle="tooltip" title="Delete file" class="pull-right">
                                                            <i class="fa fa-trash"></i>
                                                        </a>
                                                    </p>
                                                    <input type="hidden" name="hdPicDelete_pic0" id="hdPicDelete_pic0" value="0" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Product logo</label>
                                            <div class="col-sm-9">
                                                <input type="file" id="pic1" name="pic1" onchange="reviewUpload(this)" />
                                                <div style="padding-left:0px;display:block" class="col-sm-12" id="review_pic1">
                                                    <p class="col-sm-12" style="border:1px dotted red; padding:3px">
                                                        <img id="img_pic1" src="@picturepro" style="height:100px;margin-left:0" alt="preview" />
                                                        <i style="padding-left:5px" id="fname_pic1"></i>
                                                        <a onclick="upload_delete('pic1')" href="#" data-toggle="tooltip" title="Delete file" class="pull-right">
                                                            <i class="fa fa-trash"></i>
                                                        </a>
                                                    </p>
                                                    <input type="hidden" name="hdPicDelete_pic1" id="hdPicDelete_pic1" value="0" />
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Company name <span style="color:red">*</span></label>
                                            <div class="col-sm-9">
                                                <input type="text" name="CompanyName" class="form-control" value="@Model.CompanyName" required />
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Company address <span style="color:red">*</span></label>
                                            <div class="col-sm-2">
                                                <input type="text" placeholder="Street address" name="StreetAddress" class="form-control" value="@(string.IsNullOrWhiteSpace(Model.CompanyAddress) == true ? "" : Model.CompanyAddress?.Split(new char[] { '|' })[0])" required />
                                            </div>
                                            <div class="col-sm-2">
                                                <input type="text" placeholder="City" name="City" class="form-control" value="@(string.IsNullOrWhiteSpace(Model.CompanyAddress) == true ? "" : Model.CompanyAddress?.Split(new char[] { '|' })[1])" required />
                                            </div>
                                            <div class="col-sm-1">
                                                <input type="text" id="state" placeholder="State" name="State" class="form-control" value="@(string.IsNullOrWhiteSpace(Model.CompanyAddress) == true ? "" : Model.CompanyAddress?.Split(new char[] { '|' })[2])" required />
                                            </div>
                                            <div class="col-sm-2">
                                                <input type="text" placeholder="Zipcode" name="Zipcode" class="form-control" value="@(string.IsNullOrWhiteSpace(Model.CompanyAddress) == true ? "" : Model.CompanyAddress?.Split(new char[] { '|' })[3])" required />
                                            </div>
                                            <div class="col-sm-2">
                                                <input type="text" id="country" placeholder="Country" name="Country" class="form-control" value="@(string.IsNullOrWhiteSpace(Model.CompanyAddress) == true ? "" : Model.CompanyAddress?.Split(new char[] { '|' })[4])" required />
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Company phone <span style="color:red">*</span></label>
                                            <div class="col-sm-9">
                                                <input type="text" name="CompanyHotline" class="form-control" value="@Model.CompanyHotline" required />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Company support number <span style="color:red">*</span></label>
                                            <div class="col-sm-9">
                                                <input type="text" name="CompanySupportNumber" @*pattern="[0-9]{10}"*@ class="form-control" value="@Model.CompanySupportNumber" required />
                                                @*<span style="font-size:0.9em;color:gray">Phone number with 10 digit</span>*@
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Company fax</label>
                                            <div class="col-sm-9">
                                                <input type="text" name="CompanyFax" class="form-control" value="@Model.CompanyFax" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Brand name/Common name</label>
                                            <div class="col-sm-9">
                                                <input type="text" name="ProductName" class="form-control" value="@Model.ProductName" />
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Notification email</label>
                                            <div class="col-sm-9">
                                                <input type="text" name="NotificationEmail" class="form-control" value="@Model.NotificationEmail" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Billing notification email</label>
                                            <div class="col-sm-9">
                                                <input type="text" name="BillingNotification" class="form-control" value="@Model.BillingNotification" />
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Admin email</label>
                                            <div class="col-sm-9">
                                                <input type="text" name="AdminEmail" class="form-control" value="@Model.AdminEmail" />
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Support email</label>
                                            <div class="col-sm-9">
                                                <input type="text" name="SupportEmail" class="form-control" value="@Model.SupportEmail" />
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Sales email</label>
                                            <div class="col-sm-9">
                                                <input type="text" name="SalesEmail" class="form-control" value="@Model.SalesEmail" />
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">HR email</label>
                                            <div class="col-sm-9">
                                                <input type="text" name="HREmail" class="form-control" value="@Model.HREmail" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">System Timezone</label>
                                            <div class="col-sm-9">
                                                <select name="SystemTimezoneId" class="form-control" required>
                                                    @foreach (var item in tz.ToList())
                                                    {
                                                        <option value="@item.Id" @(Model.SystemTimezoneId==item.Id?"selected":"")>@item.DisplayName</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="box-footer">
                                        <button type="submit" class="btn btn-primary" name="submit" value="0">Save</button>
                                    </div>
                                </div>
                                <div id="optionals_tab" class="main_tab" style="min-height:300px; display:none">
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <table id="table_optional" style="width:100%">
                                                <tbody>
                                                    <tr style="border-bottom: 1px solid lightgray">
                                                        <td>
                                                            <label>Mango POS active automation when payment completed </label><br />
                                                            <span>If this option is enabled when the subscription invoice is complete the payment, will automatically activate the license subscription.</span>
                                                        </td>
                                                        <td style="text-align: right">
                                                            <input type="checkbox" @(Model.AutoActiveRecurringLicense == true ? "checked" : "") data-toggle="toggle" name="AutoActiveRecurringLicense" value="true" data-size="small" data-width="100" style="float:right">
                                                        </td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid lightgray">
                                                        <td>
                                                            <label>Enable send recurring and license expiration notice email to billing email </label><br />
                                                            <span>If this option is enabled, recurring and license expiration notice email will be sent to billing email</span>
                                                        </td>
                                                        <td style="text-align: right">
                                                            <input type="checkbox" @(Model.EnableSendRecurringEmailToBilling == true ? "checked" : "") data-toggle="toggle" name="EnableSendRecurringEmailToBilling" value="true" data-size="small" data-width="100" style="float:right">
                                                        </td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid lightgray">
                                                        <td>
                                                            <label>Active create onboarding ticket </label><br />
                                                            <span>If this option is enabled when the invoice is created and terminal exist , will automatically create onboarding ticket</span>
                                                        </td>
                                                        <td style="text-align: right">
                                                            <input type="checkbox" @(Model.ActiveOnboardingTicket == true ? "checked" : "") data-toggle="toggle" name="ActiveOnboardingTicket" value="true" data-size="small" data-width="100" style="float:right">
                                                        </td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid lightgray">
                                                        <td>
                                                            <label>Sale lead password default when create new Sale lead</label><br />
                                                        </td>
                                                        <td style="text-align: right">
                                                            <input type="text" class="form-control" name="MerchantPasswordDefault" value="@Model.MerchantPasswordDefault">
                                                        </td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid lightgray">
                                                        <td>
                                                            <label>Notification email will be sent to customers before the expiration date</label><br />
                                                        </td>
                                                        <td style="text-align: right">
                                                            <div class="input-group">
                                                                <input type="number" class="form-control" min="0" name="NotificationBeforeExpiration" value="@Model.NotificationBeforeExpiration">
                                                                <div class="input-group-addon">day(s)</div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid lightgray">
                                                        <td>
                                                            <label>Automatic recurring payments before the due date</label><br />
                                                        </td>
                                                        <td style="text-align: right">
                                                            <div class="input-group">
                                                                <input type="number" class="form-control" min="0" name="RecurringBeforeDueDate" value="@Model.RecurringBeforeDueDate">
                                                                <div class="input-group-addon">day(s)</div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid lightgray">
                                                        <td>
                                                            <label>Give extension days before service is deactivated if not yet payment</label><br />
                                                        </td>
                                                        <td style="text-align: right">
                                                            <div class="input-group">
                                                                <input type="number" class="form-control" min="0" name="ExtensionDay" value="@Model.ExtensionDay">
                                                                <div class="input-group-addon">day(s)</div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                   
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="box-footer">
                                        <button type="submit" class="btn btn-primary" name="submit" value="0">Save</button>
                                    </div>
                                </div>
                                <div id="optinon_config" class="main_tab" style="min-height:300px; display:none">
                                    <div class="box" style="border-top:none">
                                        <!-- /.box-header -->
                                        <div class="box-body">
                                            <div class="row" style="margin:0px">
                                                <div id="search_form" style="margin:0px 15px;">
                                                    <div class="row form-inline filter-group">
                                                        <div class="col-md-3 col-sm-6 form-group" style="margin-bottom:5px;margin-right:5px;">
                                                            <div class="input-group" style="width:100%">
                                                                <div class="input-group-addon">
                                                                    Key
                                                                </div>
                                                                <input type="text" class="form-control change-search" id="SearchName" name="SearchName" />
                                                            </div>
                                                            <!-- /.input group -->
                                                        </div>
                                                        <div class="col-md-3 col-sm-6 form-group" style="margin-bottom:5px">
                                                            <div class="input-group" style="width:100%">
                                                                <div class="input-group-addon">
                                                                    Description
                                                                </div>
                                                                <input type="text" class="form-control change-search" id="SearchDescription" name="SearchDescription" />
                                                            </div>
                                                            <!-- /.input group -->
                                                        </div>

                                                        <div class="col-md-3 col-sm-6 form-group" style="margin-bottom:5px">
                                                            <button type="button" class="btn btn-primary btn-flat" id="search_submit" name="search_submit">
                                                                <i class="fa fa-search"></i> Search
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <hr />
                                            <div class="text-right">
                                                <a href="/CommSetting/RestartApplication" onclick="return confirm('Are you sure?')" class="btn btn-success">Restart Application</a>
                                            </div>
                                            <table class="table table-bordered table-hover table-option-configuration" style="width:100%">
                                                <thead>
                                                    <tr class="bg-primary">
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>

                                        </div>
                                        <!-- /.box-body -->
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>


@section script{
    <link href="~/Content/bootstrap-toggle/bootstrap-toggle.min.css" rel="stylesheet" />
    <script src="~/Scripts/upload_and_review.js"></script>
    <script src="~/Content/bootstrap-toggle/bootstrap-toggle.min.js"></script>
    <script type="text/javascript">

        $(function () {
            load_autocomplete();
            $("#main_tab a").click(function () {
                var act = $($(this).data("tab")).show();
                $(".main_tab").not(act).hide();
            })
        })

        function load_autocomplete() {
            // alert("load autocomplete");
            $.ajax({
                method: "POST",
                url: "/Merchantman/LoadListState",
                dataType: "json"
            })
                .done(function (data) {
                    $('#state').autocomplete
                        ({
                            source: data[0],
                            minLength: 0
                        }).focus(function () {
                            $(this).autocomplete('search', $(this).val())
                        });;
                    $("#country").autocomplete({
                        source: data[1],
                        minLength: 0
                    }).focus(function () {
                        $(this).autocomplete('search', $(this).val())
                    });;
                    $('#ship_state').autocomplete
                        ({
                            source: data[0],
                            minLength: 0
                        }).focus(function () {
                            $(this).autocomplete('search', $(this).val())
                        });;
                    $("#ship_country").autocomplete({
                        source: data[1],
                        minLength: 0
                    }).focus(function () {
                        $(this).autocomplete('search', $(this).val())
                    });;
                })
                .fail(function () {
                })
                .always(function () {
                });
        }
    </script>
    <script>
        $(document).ready(function () {
            $('.table-option-configuration').DataTable({
                processing: true,
                serverSide: true,
                ajax:
                {
                    url: "/CommSetting/AllOptionConfiguration",
                    type: "POST",
                    dataType: "json",
                    data: function (data) {
                        data.SearchName = $('#SearchName').val();
                        data.SearchDescription = $('#SearchDescription').val();
                        return data;
                    }
                },
                scrollX: true,
                info: true,
                searching: false,
                paging: true,
                pagingType: 'simple_numbers',
                language: {
                    "emptyTable": "No data available in table",
                    "info": "_START_-_END_ of _TOTAL_ items",
                    "infoEmpty": "No records",
                    "infoFiltered": "(filtered from _MAX_ total entries)",
                    "thousands": ",",
                    "lengthMenu": "Show _MENU_ items",
                    "loadingRecords": "Loading...",
                    "processing": '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>',
                    "zeroRecords": "No matching records found",
                    "paginate": {
                        "first": '<i class="fa fa-angle-double-left" aria-hidden="true"></i>',
                        "last": '<i class="fa fa-angle-double-right" aria-hidden="true"></i>',
                        "next": '<i class="fa fa-angle-right" aria-hidden="true"></i>',
                        "previous": '<i class="fa fa-angle-left" aria-hidden="true"></i>'
                    },
                },
                pageLength: 15,
                lengthChange: false,
                ordering: false,
                columns: [
                    {
                        title: 'Key',
                        visible: true,
                        searchable: false,
                        createdCell: function (td, cellData, rowData, row, col) {
                            $(td).attr('data-columnname', 'Key');
                        },
                        render: function (data, type, row, meta) {
                            return data
                        },
                        data: 'Key'
                    },
                    {
                        title: 'Value',
                        width: '200',
                        visible: true,
                        searchable: false,
                        createdCell: function (td, cellData, rowData, row, col) {
                            $(td).attr('data-columnname', 'Value');
                        },
                        render: function (data, type, row, meta) {
                            return data
                        },
                        data: 'Value'
                    },
                    {
                        title: 'Description',
                        visible: true,
                        searchable: false,
                        createdCell: function (td, cellData, rowData, row, col) {
                            $(td).attr('data-columnname', 'Description');
                        },
                        render: function (data, type, row, meta) {
                            return data
                        },
                        data: 'Description'
                    },
                    {
                        title: 'Edit',
                        width: '200',
                        visible: true,
                        searchable: false,
                        className: 'button-column',
                        createdCell: function (td, cellData, rowData, row, col) {
                            $(td).attr('data-columnname', 'Id');
                        },
                        render: function (data, type, row, meta) {
                            var origData = data;
                            var modData = data;
                            if (typeof data == 'string') {
                                modData = data.replace(/[.*+?^${}()|[\]\\]/g, "_");
                            }
                            return '<a href="#" class="btn btn-default" id="buttonEdit_settings_grid' + modData + '" onclick="editData_settings_grid($(this).parent().parent(), \'' + origData + '\');return false;"><i class="fa fa-pencil"></i> Edit</a>' +
                                '<a href="#" class="btn btn-default mr-2"  id="buttonConfirm_settings_grid' + modData + '" style="display:none" onclick="confirmEditData_settings_grid($(this).parent().parent(), \'' + origData + '\', \'Id\');return false;"><i class="fa fa-check"></i> Update</a>' +
                                '<a href="#" class="btn btn-default" id="buttonCancel_settings_grid' + modData + '" style="display:none" onclick="cancelEditData_settings_grid(\'' + row + '\', \'' + origData + '\');return false;"><i class="fa fa-ban"></i> Cancel</a>';
                        },
                        data: 'Id'
                    }
                    //,
                    //{

                    //    title: 'Delete',
                    //    width: '100',
                    //    visible: true,
                    //    searchable: false,
                    //    className: 'button-column',
                    //    createdCell: function (td, cellData, rowData, row, col) {
                    //        $(td).attr('data-columnname', 'Id');
                    //    },
                    //    render: function (data, type, row, meta) {
                    //        return '<a href="#" class="btn btn-default" onclick="table_deletedata_settings_grid(\'' + data + '\');return false;"><i class="fa fa-trash"></i>Delete</a>';
                    //    },
                    //    data: 'Id'
                    //}
                ]
            });
            $('#search_submit').click(function () {
                $('.table-option-configuration').DataTable().ajax.reload();
                return false;
            });
            $(".change-search").keydown(function (event) {
                if (event.keyCode === 13) {
                    $('.table-option-configuration').DataTable().ajax.reload();
                    return false;
                }
            });
            $('.table-option-configuration').DataTable().columns.adjust();
            $(".optionals_tab_label").click(function () {
                $('.table-option-configuration').DataTable().columns.adjust();
            })
        });


        //function table_deletedata_settings_grid(dataId) {
        //    if (confirm('Are you sure you want to delete this item?')) {
        //        var postData = {
        //            id: dataId
        //        };
        //        $.ajax({
        //            url: "/Admin/Setting/SettingDelete",
        //            type: "POST",
        //            dataType: "json",
        //            data: postData,
        //            success: function (data, textStatus, jqXHR) {
        //                //display error if returned
        //                if (data) {
        //                    display_nop_error(data);
        //                }
        //                //refresh grid
        //                $('.table-option-configuration').DataTable().draw(false);
        //            },
        //            error: function (jqXHR, textStatus, errorThrown) {
        //                alert(errorThrown);
        //            }
        //        });
        //    }
        //    else {
        //        return false;
        //    }
        //}

        var editIndexTable_settings_grid = -1;
        var editRowData_settings_grid = [];
        var columnData_settings_grid = [];

        //var obj = { 'Data': 'Key', 'Editable': true, 'Type': 'string' }
        //columnData_settings_grid.push(obj);

        var obj = { 'Data': 'Value', 'Editable': true, 'Type': 'string' }
        columnData_settings_grid.push(obj);
        var obj = { 'Data': 'Description', 'Editable': true, 'Type': 'string' }
        columnData_settings_grid.push(obj);

        function editData_settings_grid(dataId, data) {
            var modData = data;
            if (typeof data == 'string') {
                modData = data.replace(/[.*+?^${}()|[\]\\]/g, "_");
            }
            $('#buttonEdit_settings_grid' + modData).hide();
            $('#buttonConfirm_settings_grid' + modData).show();
            $('#buttonCancel_settings_grid' + modData).show();
            rowEditMode_settings_grid(dataId);
        }

        function rowEditMode_settings_grid(rowid) {
            var prevRow;
            var rowIndexVlaue = parseInt(rowid[0].rowIndex);
            if (editIndexTable_settings_grid == -1) {
                saveRowIntoArray_settings_grid(rowid);
                rowid.attr("editState", "editState");
                editIndexTable_settings_grid = rowid.rowIndex;
                setEditStateValue_settings_grid(rowid);
            }
            else {
                prevRow = $("[editState=editState]");
                prevRow.attr("editState", "");
                rowid.attr("editState", "editState");
                editIndexTable_settings_grid = rowIndexVlaue;
                saveArrayIntoRow_settings_grid(prevRow);
                saveRowIntoArray_settings_grid(rowid);
                setEditStateValue_settings_grid(rowid);
            }
        }

        function escapeQuotHtml(value) {
            return String(value).replace(/["]/g, function (s) {
                return '&quot;';
            });
        }

        function setEditStateValue_settings_grid(curRow) {
            for (var cellName in editRowData_settings_grid) {
                var columnType = 'string';

                $.each(columnData_settings_grid, function (index, element) {
                    if (element.Data == cellName) {
                        columnType = element.Type;
                    }
                });

                if (columnType == 'number') {
                    $($(curRow).children("[data-columnname='" + cellName + "']")[0]).html('<input value="' + editRowData_settings_grid[cellName] + '" class="userinput" type="number" step="any" min="-2147483648" max="2147483647"/>');
                }
                if (columnType == 'checkbox') {
                    var cellValue = editRowData_settings_grid[cellName];
                    if ($(cellValue).attr('nop-value') === 'true') {
                        $($(curRow).children("[data-columnname='" + cellName + "']")[0]).html('<input value="true" checked class="userinput" type="checkbox" onclick="checkBoxClick_settings_grid(this)"/>');
                    }
                    else {
                        $($(curRow).children("[data-columnname='" + cellName + "']")[0]).html('<input value="false" class="userinput" type="checkbox" onclick="checkBoxClick_settings_grid(this)"/>');
                    }
                }
                if (columnType == 'string') {
                    var strValue = editRowData_settings_grid[cellName];
                    $($(curRow).children("[data-columnname='" + cellName + "']")[0]).html('<input value="' + escapeQuotHtml(strValue) + '" class="userinput"  style="width: 99% " />');
                }
                $('.table-option-configuration').DataTable().columns.adjust();
            }
        }

        function checkBoxClick_settings_grid(checkBox) {
            var input = $(checkBox);
            if ($(input).val() === 'true') {
                $(input).val('false');
                $(input).removeAttr('checked');
            } else {
                $(input).val('true');
                $(input).attr('checked', 'checked');
            }
        }

        function confirmEditData_settings_grid(dataId, data, nameData) {
            var origData = data;
            var modData = data;
            if (typeof data == 'string') {
                modData = data.replace(/[.*+?^${}()|[\]\\]/g, "_");
            }
            $('#buttonEdit_settings_grid' + modData).show();
            $('#buttonConfirm_settings_grid' + modData).hide();
            $('#buttonCancel_settings_grid' + modData).hide();

            updateRowData_settings_grid(dataId, origData, nameData);
        }

        function updateRowData_settings_grid(currentCells, data, nameData) {
            var updateRowData = [];
            updateRowData.push({ 'pname': nameData, 'pvalue': data });
            $.each(columnData_settings_grid, function (index, element) {
                if (element.Editable == true) {
                    var value = $($($(currentCells).children("[data-columnname='" + element.Data + "']")).children('input')[0]).val();
                    if (element.Type == 'number') {
                        value = new Intl.NumberFormat('en-US', { useGrouping: false }).format(value);
                    }
                    updateRowData.push({
                        'pname': element.Data, 'pvalue': value
                    });
                }
            });
            var postData = {};
            for (i = 0; i < updateRowData.length; i++) {
                postData[updateRowData[i].pname] = updateRowData[i].pvalue;
            }
            $.ajax({
                url: "/CommSetting/OptionConfigUpdate",
                type: "POST",
                dataType: "json",
                data: postData,
                success: function (data, textStatus, jqXHR) {
                    //display error if returned
                    if (!data.status) {
                        alert(data);
                    }
                    else {
                        noty({ "text": "update success", "layout": "topRight", "type": "success" });
                    }
                    //refresh grid
                    $('.table-option-configuration').DataTable().draw(false);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        }

        function cancelEditData_settings_grid(dataId, data) {
            var modData = data;
            if (typeof data == 'string') {
                modData = data.replace(/[.*+?^${}()|[\]\\]/g, "_");
            }
            $('#buttonEdit_settings_grid' + modData).show();
            $('#buttonConfirm_settings_grid' + modData).hide();
            $('#buttonCancel_settings_grid' + modData).hide();

            var prevRow = $("[editState=editState]");
            prevRow.attr("editState", "");
            if (prevRow.length > 0) {
                saveArrayIntoRow_settings_grid($(prevRow));
            }
            editIndexTable_settings_grid = -1;
        }

        function saveArrayIntoRow_settings_grid(cureentCells) {
            for (var cellName in editRowData_settings_grid) {
                $($(cureentCells).children("[data-columnname='" + cellName + "']")[0]).html(editRowData_settings_grid[cellName]);
            }
        }

        function saveRowIntoArray_settings_grid(cureentCells) {
            $.each(columnData_settings_grid, function (index, element) {
                if (element.Editable == true) {
                    var htmlVal = $($(cureentCells).children("[data-columnname='" + element.Data + "']")[0]).html();
                    editRowData_settings_grid[element.Data] = htmlVal;
                }
            });
        }
    </script>

}